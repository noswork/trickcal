<!DOCTYPE html>
<html lang="zh-TW" id="htmlRoot">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trickcal -金蠟筆筆記本</title>
    <meta name="description" content="管理你的角色收藏與著色版進度。" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://noswork.github.io/trickcal/board/" />
    <meta property="og:title" content="金蠟筆筆記本" />
    <meta property="og:description" content="管理你的角色收藏與著色版進度。" />
    <meta property="og:image" content="https://noswork.github.io/trickcal/assets/icons/favicon.png" />
    <meta property="og:image:width" content="512" />
    <meta property="og:image:height" content="512" />
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:url" content="https://noswork.github.io/trickcal/board/" />
    <meta name="twitter:title" content="Trickcal Board" />
    <meta name="twitter:description" content="金蠟筆筆記本" />
    <meta name="twitter:image" content="https://noswork.github.io/trickcal/assets/icons/favicon.png" />
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../assets/icons/favicon.png">
    <link rel="apple-touch-icon" href="../assets/icons/favicon.png">
    
    <link rel="stylesheet" href="css/board.css">
    <link rel="stylesheet" href="../common/css/layout.css">
    
    <!-- 預載入主題 - 防止閃爍 -->
    <script>
        // 在 HTML 解析前立即套用主題（統一使用 trickcal_theme）
        (function() {
            const savedTheme = localStorage.getItem('trickcal_theme') || 'dark';
            // 在 DOMContentLoaded 之前設置，如果 body 還不存在則等待
            if (document.body) {
                document.body.dataset.theme = savedTheme;
            } else {
                document.addEventListener('DOMContentLoaded', function() {
                    document.body.dataset.theme = savedTheme;
                });
            }
        })();
    </script>
    
    <!-- Supabase JS SDK - 使用計數器需要 -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" 
            crossorigin="anonymous"></script>
    <script src="../common/storage-keys.js"></script>
    <script src="../common/locales.js"></script>
    <script src="../common/language-selector.js"></script>
    <script src="../common/notification.js"></script>
    <script src="../common/usage-counter.js"></script>
    
    <style>
        /* 兼容原樣式空間，現改由通用 nav 控制 */
    </style>
</head>
<body class="with-background" oncontextmenu="return false" ondragstart="return false" onselectstart="return false">
    <div id="siteHeader"></div>
    <main class="board-layout">
        <aside class="panel layer-panel">
            <div class="layer-tabs">
                <button class="tab-btn active" data-layer="layer1">第一層</button>
                <button class="tab-btn" data-layer="layer2">第二層</button>
                <button class="tab-btn" data-layer="layer3">第三層</button>
            </div>
            <div class="panel-card" id="layerSummary"></div>
        </aside>

        <section class="board-stage" id="boardStage">
            <div class="board-stage-header">
                <div>
                    <h2 id="currentLayerTitle">第一層</h2>
                </div>
                <!-- 排序控制 -->
                <div class="sort-controls">
                    <div class="custom-select-wrapper">
                        <div class="custom-select" id="boardSortSelect">
                            <div class="select-trigger">
                                <span class="select-label" data-i18n="settings.sortDefault">預設順序</span>
                                <svg class="select-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M7 10L12 15L17 10H7Z" fill="currentColor"/>
                                </svg>
                            </div>
                            <div class="select-options">
                                <div class="select-option active" data-value="default">
                                    <span data-i18n="settings.sortDefault">預設順序</span>
                                </div>
                                <div class="select-option" data-value="stars">
                                    <span data-i18n="settings.sortStars">星級</span>
                                </div>
                                <div class="select-option" data-value="role">
                                    <span data-i18n="settings.sortRole">類型</span>
                                </div>
                                <div class="select-option" data-value="personality">
                                    <span data-i18n="settings.sortPersonality">性格</span>
                                </div>
                                <div class="select-option" data-value="attackType">
                                    <span data-i18n="settings.sortAttackType">攻擊類型</span>
                                </div>
                                <div class="select-option" data-value="deployRow">
                                    <span data-i18n="settings.sortDeployRow">部署列</span>
                                </div>
                                <div class="select-option" data-value="race">
                                    <span data-i18n="settings.sortRace">種族</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button id="boardSortOrderBtn" class="sort-order-btn" title="" data-i18n-title="settings.sortOrderAsc">
                        <svg class="sort-icon sort-asc" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 4L6 10L7.41 11.41L11 7.83V20H13V7.83L16.59 11.41L18 10L12 4Z" fill="currentColor"/>
                        </svg>
                        <svg class="sort-icon sort-desc" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 20L18 14L16.59 12.59L13 16.17V4H11V16.17L7.41 12.59L6 14L12 20Z" fill="currentColor"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="board-stage-body">
                <!-- 分頁導航 -->
                <div class="board-pagination">
                    <button class="page-btn active" data-cell-type="attack" data-i18n="cellTypes.attack">攻擊力</button>
                    <button class="page-btn" data-cell-type="crit" data-i18n="cellTypes.crit">暴擊</button>
                    <button class="page-btn" data-cell-type="hp" data-i18n="cellTypes.hp">HP</button>
                    <button class="page-btn" data-cell-type="critResist" data-i18n="cellTypes.critResist">暴擊抵抗</button>
                    <button class="page-btn" data-cell-type="defense" data-i18n="cellTypes.defense">防禦力</button>
                </div>
                <div class="board-grid" id="boardContent">
                    <!-- 動態生成 -->
                </div>
            </div>
        </section>

        <aside class="panel insight-panel">
            <div class="panel-card" id="ownershipStats"></div>
            <div class="panel-card" id="resourceSummary"></div>
        </aside>
    </main>

    <!-- 設置面板 -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-content">
            <h2>角色設置</h2>
            <p class="settings-desc">點擊角色圖片設定為已擁有/未擁有</p>

            <!-- 排序控制 -->
            <div class="sort-controls">
                <div class="sort-dropdown-wrapper">
                    <label for="sortSelect" class="sort-label" data-i18n="settings.sortBy">排序方式：</label>
                    <select id="sortSelect" class="sort-select">
                        <option value="default" data-i18n="settings.sortDefault">預設順序</option>
                        <option value="stars" data-i18n="settings.sortStars">星級</option>
                        <option value="role" data-i18n="settings.sortRole">類型</option>
                        <option value="personality" data-i18n="settings.sortPersonality">性格</option>
                        <option value="attackType" data-i18n="settings.sortAttackType">攻擊類型</option>
                        <option value="deployRow" data-i18n="settings.sortDeployRow">部署列</option>
                        <option value="race" data-i18n="settings.sortRace">種族</option>
                    </select>
                </div>
                <button id="sortOrderBtn" class="sort-order-btn" title="" data-i18n-title="settings.sortOrderAsc">
                    <svg class="sort-icon sort-asc" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 4L6 10L7.41 11.41L11 7.83V20H13V7.83L16.59 11.41L18 10L12 4Z" fill="currentColor"/>
                    </svg>
                    <svg class="sort-icon sort-desc" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 20L18 14L16.59 12.59L13 16.17V4H11V16.17L7.41 12.59L6 14L12 20Z" fill="currentColor"/>
                    </svg>
                </button>
            </div>

            <div class="character-grid" id="settingsCharacterGrid"></div>

            <div class="settings-actions">
                <button class="btn btn-secondary" id="resetAllBtn">重置全部</button>
                <button class="btn btn-primary" id="closeSettingsBtn">關閉</button>
            </div>
        </div>
    </div>

    <div id="siteFooter"></div>
    <!-- 載入 JavaScript -->
    <script src="i18n.js"></script>
    <script src="../common/site.js" defer></script>
    <script src="character-card-helpers.js"></script>
    <script src="app.js"></script>
</body>
</html>

